<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pace Calculator + Track Splits</title>
  <style>
    :root {
      --bg-gradient-start: #0f172a;
      --bg-gradient-end: #1e1e2e;
      --card-bg: rgba(30, 41, 59, 0.6);
      --card-border: rgba(148, 163, 184, 0.12);
      --card-shadow: rgba(0, 0, 0, 0.6);

      --radius-lg: 1.25rem;
      --radius-sm: 0.75rem;

      --accent-start: #6366f1;
      --accent-end: #a855f7;

      --text-primary: #fff;
      --text-dim: #a3aed0;
      --text-secondary: #c7d2fe;

      --text-error-bg: #2a0c0c;
      --text-error-border: #ef4444;

      --surface-input: rgba(15, 23, 42, 0.6);
      --surface-input-focus: rgba(15, 23, 42, 0.9);
      --surface-panel: rgba(2, 6, 23, 0.5);

      --border-default: #475569;
      --border-panel: rgba(71, 85, 105, 0.6);
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", Arial, sans-serif;
      background:
        radial-gradient(circle at 20% 20%, rgba(99,102,241,0.25) 0%, transparent 60%),
        radial-gradient(circle at 80% 10%, rgba(168,85,247,0.18) 0%, transparent 60%),
        radial-gradient(circle at 50% 80%, rgba(16,185,129,0.12) 0%, transparent 70%),
        linear-gradient(160deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text-primary);
    }

    /* keep inputs contained */
    *, *::before, *::after { box-sizing: border-box; }
    .panel { overflow: hidden; }
    input, select, button { max-width: 100%; display: block; }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(16px) saturate(140%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      box-shadow: 0 40px 120px var(--card-shadow);
      width: 100%;
      max-width: 860px;
      padding: 1.25rem 1.25rem 1rem;
      position: relative;
    }

    h1 { text-align: center; margin: 0.25rem 0 0.5rem; font-size: 1.25rem; font-weight: 700; }
    h1 span.sub { display:block; font-size: .8rem; color: var(--text-dim); font-weight: 400; }

    .tabs { display:flex; gap:.5rem; justify-content:center; margin:.75rem 0 1rem; flex-wrap:wrap; }
    .tab-btn { border:1px solid var(--border-default); background:var(--surface-input); color:#fff; padding:.55rem .9rem; border-radius:999px; cursor:pointer; font-weight:600; }
    .tab-btn.active { background-image: linear-gradient(90deg, var(--accent-start), var(--accent-end)); border-color: transparent; box-shadow: 0 8px 24px rgba(124,58,237,0.35); }

    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 800px){ .grid{ grid-template-columns: 1fr; } }

    .panel { background: var(--surface-panel); border-radius: var(--radius-sm); border:1px solid var(--border-panel); padding:1rem; }

    .field { margin-bottom: .9rem; display:flex; flex-direction: column; }
    label { font-size: .8rem; color: var(--text-dim); margin-bottom:.35rem; font-weight:500; }
    input, select, button { width:100%; border-radius: var(--radius-sm); border:1px solid var(--border-default); background: var(--surface-input); color:#fff; padding:.75rem .9rem; font-size:.95rem; line-height:1.3; }
    input:focus, select:focus { border-color: var(--accent-start); box-shadow: 0 0 20px rgba(99,102,241,0.5); background: var(--surface-input-focus); outline: none; }
    button { cursor:pointer; font-weight:700; background-image: linear-gradient(90deg, var(--accent-start), var(--accent-end)); border:0; color:#fff; box-shadow:0 20px 40px rgba(124,58,237,0.4); margin-top:.5rem; }

    .error { background: var(--text-error-bg); border:1px solid var(--text-error-border); color:#fff; border-radius: var(--radius-sm); padding:.75rem 1rem; font-size:.8rem; margin-bottom:1rem; display:none; }

    .results-label { font-size:.75rem; color: var(--text-dim); text-transform:uppercase; letter-spacing:.05em; margin:.75rem 0 .35rem; }
    .results-panel { background: var(--surface-panel); border:1px solid var(--border-panel); border-radius: var(--radius-sm); box-shadow: inset 0 0 20px rgba(0,0,0,.6); font-size:.95rem; color:#e2e8f0; padding:1rem 1.2rem; height:260px; overflow:auto; }
    .results-panel p { margin:.25rem 0; }
    .results-panel .label { color: var(--text-secondary); font-weight:500; }

    .hidden{ display:none; }

    .track-wrap{ display:flex; align-items:center; justify-content:center; background: rgba(15,23,42,0.45); border:1px solid var(--border-panel); border-radius: var(--radius-sm); padding:.5rem; }
    svg { width:100%; height:260px; }
  </style>
</head>
<body>
  <main class="card">
    <h1>Pace Toolkit <span class="sub">Pace calculator • Track splits visualizer</span></h1>

    <div class="tabs">
      <button id="tabBtnPace" class="tab-btn active" aria-controls="tab-pace">Pace Calculator</button>
      <button id="tabBtnSplits" class="tab-btn" aria-controls="tab-splits">Track Splits</button>
    </div>

    <!-- Pace Calculator TAB -->
    <section id="tab-pace">
      <div id="errorBox" class="error"></div>
      <div class="grid">
        <div class="panel">
          <div class="field">
            <label for="distanceInput">Enter the distance you ran</label>
            <input id="distanceInput" type="number" min="0" step="any" placeholder="e.g. 5.5 or 8000" />
          </div>
          <div class="field">
            <label for="unitSelect">Measurement</label>
            <select id="unitSelect">
              <option value="">Select unit</option>
              <option>Meters</option>
              <option>Miles</option>
              <option>Kilometers</option>
            </select>
          </div>
          <div class="field">
            <label for="timeInput">Enter the time you ran <span class="hint">MM:SS or HH:MM:SS</span></label>
            <input id="timeInput" type="text" placeholder="25:17 or 1:14:52" />
          </div>
          <div class="field" style="display:flex;align-items:center;gap:.5rem;">
            <input type="checkbox" id="showHundredths" />
            <label for="showHundredths" style="margin:0;">Show hundredths of a second</label>
          </div>
          <button id="calcBtn">Calculate Pace</button>
        </div>
        <div class="panel">
          <div class="results-label">Results</div>
          <div id="resultsBox" class="results-panel"><p class="hint">Your pace and splits will appear here…</p></div>
        </div>
      </div>
    </section>

    <!-- Track Splits TAB -->
    <section id="tab-splits" class="hidden">
      <div id="errorBoxSplits" class="error"></div>
      <div class="grid">
        <div class="panel">
          <div class="field">
            <label for="raceDistanceValue">Race distance</label>
            <input id="raceDistanceValue" type="number" min="0" step="any" placeholder="e.g. 1, 1600, 5" />
          </div>
          <div class="field">
            <label for="raceDistanceUnit">Unit</label>
            <select id="raceDistanceUnit">
              <option value="meters">Meters</option>
              <option value="kilometers">Kilometers</option>
              <option value="miles" selected>Miles</option>
            </select>
          </div>
          <div class="field">
            <label for="targetTime">Target time <span class="hint">MM:SS or HH:MM:SS</span></label>
            <input id="targetTime" type="text" placeholder="4:20 or 1:59:30" />
          </div>
          <div class="field">
            <label for="trackLength">Track length (meters)</label>
            <input id="trackLength" type="number" min="10" step="any" placeholder="e.g. 300" />
          </div>
          <button id="calcSplitsBtn">Calculate race splits</button>
        </div>
        <div class="panel">
          <div class="results-label">Track & Splits</div>
          <div class="track-wrap">
            <svg id="trackSvg" viewBox="0 0 600 300" aria-label="Track diagram">
              <!-- Outer/inner lane borders -->
              <rect x="50" y="25" rx="100" ry="100" width="500" height="250" fill="#0b1224" stroke="#334155" stroke-width="6" />
              <rect x="70" y="45" rx="80" ry="80" width="460" height="210" fill="#111827" stroke="#1f2937" stroke-width="2" />
              <!-- Finish line (fixed at bottom-right, short segment on lane centerline) -->
              <line id="finishLine" x1="0" y1="0" x2="0" y2="0" stroke="#ffffff" stroke-width="2" stroke-dasharray="6,4" />
              <!-- Start dot (lane centerline) -->
              <circle id="startDot" cx="300" cy="150" r="6" fill="#facc15" stroke="#a16207" stroke-width="2" />
              <g id="svgLabels" font-family="Inter, system-ui, sans-serif" font-size="12" fill="#cbd5e1">
                <text id="lapInfo" x="20" y="290">—</text>
              </g>
            </svg>
          </div>
          <div id="splitsBox" class="results-panel" style="margin-top:.6rem; height:200px;"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== Utilities =====
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }
    function showError(el, msg){ el.style.display='block'; el.textContent = msg; }
    function clearError(el){ el.style.display='none'; el.textContent=''; }

    function parseTimeToSecondsStrict(t){
      const parts = t.split(":");
      if (parts.length !== 2 && parts.length !== 3) throw new Error("Time must be MM:SS or HH:MM:SS");
      const nums = parts.map(p=>{ const n = parseInt(p,10); if (isNaN(n)) throw new Error("Time must only contain numbers and ':'"); return n; });
      let [h,m,s] = [0,0,0];
      if (nums.length===2){ [m,s]=nums; } else { [h,m,s]=nums; }
      if (s>=60) throw new Error("Seconds should be < 60");
      return h*3600 + m*60 + s;
    }
    function fmt(sec, hundredths=false){
      if (hundredths){
        const total = sec; const h=Math.floor(total/3600); const m=Math.floor((total%3600)/60); const s=(total%60).toFixed(2).padStart(5,'0');
        return h>0? `${h}:${String(m).padStart(2,'0')}:${s}` : `${m}:${s}`;
      } else {
        const total = Math.round(sec); const h=Math.floor(total/3600); const m=Math.floor((total%3600)/60); const s=total%60;
        return h>0? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` : `${m}:${String(s).padStart(2,'0')}`;
      }
    }

    // ===== Tabs =====
    const tabBtnPace = document.getElementById('tabBtnPace');
    const tabBtnSplits = document.getElementById('tabBtnSplits');
    const tabPace = document.getElementById('tab-pace');
    const tabSplits = document.getElementById('tab-splits');

    function activate(tab){
      if (tab==='pace'){ tabBtnPace.classList.add('active'); tabBtnSplits.classList.remove('active'); show(tabPace); hide(tabSplits); }
      else { tabBtnSplits.classList.add('active'); tabBtnPace.classList.remove('active'); show(tabSplits); hide(tabPace); }
    }
    tabBtnPace.addEventListener('click', ()=>activate('pace'));
    tabBtnSplits.addEventListener('click', ()=>activate('splits'));

    // ===== Pace Calculator =====
    const resultsBox = document.getElementById("resultsBox");
    const errorBox = document.getElementById("errorBox");
    const showHundredths = document.getElementById("showHundredths");
    const unitSelect = document.getElementById('unitSelect');

    function calculate(){
      clearError(errorBox); resultsBox.innerHTML = "";
      const distStr = document.getElementById("distanceInput").value.trim();
      const timeStr = document.getElementById("timeInput").value.trim();
      const unit = unitSelect.value;
      if (!distStr) return showError(errorBox, "Please enter a distance.");
      const distanceVal = parseFloat(distStr); if (isNaN(distanceVal) || distanceVal <= 0) return showError(errorBox, "Distance must be a positive number.");
      if (!unit) return showError(errorBox, "Please select a measurement.");
      let totalSeconds; try { totalSeconds = parseTimeToSecondsStrict(timeStr); } catch(err){ return showError(errorBox, "Time error: "+err.message); }
      const useHundredths = showHundredths && showHundredths.checked;

      let distanceMiles, distanceKm, unitName;
      if (unit === "Meters"){ distanceMiles = distanceVal / 1609.34; distanceKm = distanceVal / 1000.0; unitName = "meters"; }
      else if (unit === "Miles"){ distanceMiles = distanceVal; distanceKm = distanceVal * 1.60934; unitName = "miles"; }
      else { distanceKm = distanceVal; distanceMiles = distanceVal / 1.60934; unitName = "kilometers"; }

      const pacePerMile = totalSeconds / distanceMiles; const pacePerKm = totalSeconds / distanceKm;
      let html = `
        <p><span class="label">Distance:</span> ${distanceVal} ${unitName}</p>
        <p><span class="label">Time:</span> ${fmt(totalSeconds, useHundredths)}</p>
        <p><span class="label">Pace per mile:</span> ${fmt(pacePerMile, useHundredths)} min/mi</p>
        <p><span class="label">Pace per km:</span> ${fmt(pacePerKm, useHundredths)} min/km</p>
        <br><p class="label">Equivalent Splits</p>`;

      const standardDistances = {"100m":100/1609.34,"200m":200/1609.34,"400m":400/1609.34,"800m":800/1609.34,"1600m":1600/1609.34,"3200m":3200/1609.34,"5k":5000/1609.34,"6k":6000/1609.34,"8k":8000/1609.34,"10k":10000/1609.34,"Half Marathon":13.1094,"Marathon":26.2188};
      for (const label in standardDistances){
        const splitTime = fmt((totalSeconds / distanceMiles) * standardDistances[label], useHundredths);
        html += `<p><span class="label">${label}:</span> ${splitTime}</p>`;
      }
      resultsBox.innerHTML = html;
    }
    document.getElementById("calcBtn").addEventListener("click", calculate);

    // ===== Track Splits =====
    const errorBoxSplits = document.getElementById('errorBoxSplits');
    const splitsBox = document.getElementById('splitsBox');
    const startDot = document.getElementById('startDot');
    const lapInfo = document.getElementById('lapInfo');
    const finishLine = document.getElementById('finishLine');

    // Geometry from SVG rectangles
    const cx = 300, cy = 150;
    const rxOuter = 250, ryOuter = 125;
    const rxInner = 230, ryInner = 105;
    // Lane centerline (so dot & finish are BETWEEN borders)
    const rxMid = (rxOuter + rxInner) / 2; // 240
    const ryMid = (ryOuter + ryInner) / 2; // 115

    // Finish tick angle: bottom-right
    const FINISH_ANGLE = Math.PI / 4; // 45° (SVG y grows downward)

    function positionFinishLineCenterband(){
      // Short segment centered on lane centerline (same band as start dot)
      const halfSpan = 8; // pixels of radial span around centerline
      const r1x = rxMid - halfSpan, r1y = ryMid - halfSpan;
      const r2x = rxMid + halfSpan, r2y = ryMid + halfSpan;
      const x1 = cx + r1x * Math.cos(FINISH_ANGLE);
      const y1 = cy + r1y * Math.sin(FINISH_ANGLE);
      const x2 = cx + r2x * Math.cos(FINISH_ANGLE);
      const y2 = cy + r2y * Math.sin(FINISH_ANGLE);
      finishLine.setAttribute('x1', x1.toFixed(2));
      finishLine.setAttribute('y1', y1.toFixed(2));
      finishLine.setAttribute('x2', x2.toFixed(2));
      finishLine.setAttribute('y2', y2.toFixed(2));
    }
    positionFinishLineCenterband();

    function calcRaceSplits(){
      clearError(errorBoxSplits); splitsBox.innerHTML = '';
      const val = parseFloat(document.getElementById('raceDistanceValue').value);
      const unit = document.getElementById('raceDistanceUnit').value;
      const timeStr = document.getElementById('targetTime').value.trim();
      const L = parseFloat(document.getElementById('trackLength').value); // meters
      if (isNaN(val) || val<=0) return showError(errorBoxSplits, 'Enter a valid race distance.');
      if (!timeStr) return showError(errorBoxSplits, 'Enter a target time.');
      if (isNaN(L) || L<=0) return showError(errorBoxSplits, 'Enter a valid track length in meters.');
      let Dm; // race distance in meters
      if (unit==='meters') Dm = val; else if (unit==='kilometers') Dm = val*1000; else Dm = val*1609.34;

      let T; try { T = parseTimeToSecondsStrict(timeStr); } catch(e){ return showError(errorBoxSplits, 'Time error: '+e.message); }
      const pacePerMeter = T / Dm; // sec per meter

      // Correct finish-crossing math: first odd, then every L; final equals D
      let d1 = Dm % L; if (Math.abs(d1) < 1e-9) d1 = L;
      const crossings = []; for (let d = d1; d <= Dm + 1e-9; d += L) crossings.push(d);

      // Render
      let html='';
      crossings.forEach((meters,i)=>{
        const t = pacePerMeter * meters;
        const label = (Math.abs(meters - Dm) <= 1e-6) ? 'Finish' : `Pass ${i+1}`;
        html += `<p><span class="label">${label}:</span> ${fmt(t, false)} <span style="color:#94a3b8">(${meters.toFixed(1)} m)</span></p>`;
      });
      splitsBox.innerHTML = html;

      // Place start dot CLOCKWISE from finish by fracStart of a lap
      const fracStart = (Math.abs(d1 - L) <= 1e-9) ? 0 : (1 - d1 / L);
      const angle = FINISH_ANGLE - 2*Math.PI*fracStart; // clockwise
      const sx = cx + rxMid * Math.cos(angle);
      const sy = cy + ryMid * Math.sin(angle);
      startDot.setAttribute('cx', sx.toFixed(2));
      startDot.setAttribute('cy', sy.toFixed(2));

      const laps = Dm / L;
      lapInfo.textContent = `${laps.toFixed(3)} laps — start is ${(fracStart*100).toFixed(1)}% of a lap before the finish`;
    }

    document.getElementById('calcSplitsBtn').addEventListener('click', calcRaceSplits);
  </script>
</body>
</html>
